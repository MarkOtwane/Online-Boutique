<div class="cart-container">
  <div class="cart-header">
    <h1>Shopping Cart</h1>
    <p>Review your items and proceed to checkout</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <svg
      width="16"
      height="16"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
      <line
        x1="15"
        y1="9"
        x2="9"
        y2="15"
        stroke="currentColor"
        stroke-width="2"
      />
      <line
        x1="9"
        y1="9"
        x2="15"
        y2="15"
        stroke="currentColor"
        stroke-width="2"
      />
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Empty Cart State -->
  <div *ngIf="cartItems.length === 0" class="empty-cart">
    <svg
      width="120"
      height="120"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle cx="9" cy="21" r="1" stroke="currentColor" stroke-width="2" />
      <circle cx="20" cy="21" r="1" stroke="currentColor" stroke-width="2" />
      <path
        d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
    <h2>Your cart is empty</h2>
    <p>Looks like you haven't added any items to your cart yet.</p>
    <button class="btn-primary" routerLink="/products">Start Shopping</button>
  </div>

  <!-- Cart Content -->
  <div *ngIf="cartItems.length > 0" class="cart-content">
    <div class="cart-main">
      <!-- Cart Items -->
      <div class="cart-items-section">
        <div class="section-header">
          <h2>Cart Items ({{ cartItems.length }})</h2>
          <button class="btn-clear" (click)="clearCart()">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M3 6H5H21"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            Clear Cart
          </button>
        </div>

        <div class="cart-items">
          <div *ngFor="let item of cartItems" class="cart-item">
            <div class="item-image">
              <img
                [src]="
                  item.imageUrl ||
                  'https://via.placeholder.com/120x120/cccccc/666666?text=' +
                    item.name.substring(0, 2)
                "
                [alt]="item.name"
                class="product-image"
              />
            </div>

            <div class="item-details">
              <h3 class="item-name">{{ item.name }}</h3>
              <p class="item-price">{{ formatCurrency(item.price) }}</p>
            </div>

            <div class="item-quantity">
              <label>Quantity:</label>
              <div class="quantity-controls">
                <button
                  class="qty-btn"
                  (click)="updateQuantity(item, item.quantity - 1)"
                >
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5 12H19"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
                <input
                  type="number"
                  [value]="item.quantity"
                  (change)="updateQuantityFromInput(item, $event)"
                  min="1"
                  class="qty-input"
                />
                <button
                  class="qty-btn"
                  (click)="updateQuantity(item, item.quantity + 1)"
                >
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M12 5V19M5 12H19"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
              </div>
            </div>

            <div class="item-total">
              <span class="total-price">{{
                formatCurrency(item.price * item.quantity)
              }}</span>
            </div>

            <div class="item-actions">
              <button
                class="btn-remove"
                (click)="removeItem(item.id)"
                title="Remove item"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M3 6H5H21"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Checkout Form -->
      <div *ngIf="showCheckoutForm" class="checkout-section">
        <div class="section-header">
          <h2>Checkout</h2>
          <button class="btn-back" (click)="showCheckoutForm = false">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M19 12H5M12 19L5 12L12 5"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            Back to Cart
          </button>
        </div>

        <form (ngSubmit)="submitOrder()" class="checkout-form">
          <!-- Shipping Information -->
          <div class="form-section">
            <h3>Shipping Information</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name *</label>
                <input
                  id="firstName"
                  type="text"
                  [(ngModel)]="checkoutForm.firstName"
                  name="firstName"
                  class="form-input"
                  [class.error]="getFieldError('firstName')"
                />
                <span
                  *ngIf="getFieldError('firstName')"
                  class="error-message"
                  >{{ getFieldError("firstName") }}</span
                >
              </div>
              <div class="form-group">
                <label for="lastName">Last Name *</label>
                <input
                  id="lastName"
                  type="text"
                  [(ngModel)]="checkoutForm.lastName"
                  name="lastName"
                  class="form-input"
                  [class.error]="getFieldError('lastName')"
                />
                <span *ngIf="getFieldError('lastName')" class="error-message">{{
                  getFieldError("lastName")
                }}</span>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="email">Email *</label>
                <input
                  id="email"
                  type="email"
                  [(ngModel)]="checkoutForm.email"
                  name="email"
                  class="form-input"
                  [class.error]="getFieldError('email')"
                />
                <span *ngIf="getFieldError('email')" class="error-message">{{
                  getFieldError("email")
                }}</span>
              </div>
              <div class="form-group">
                <label for="phone">Phone</label>
                <input
                  id="phone"
                  type="tel"
                  [(ngModel)]="checkoutForm.phone"
                  name="phone"
                  class="form-input"
                  [class.error]="getFieldError('phone')"
                />
                <span *ngIf="getFieldError('phone')" class="error-message">{{
                  getFieldError("phone")
                }}</span>
              </div>
            </div>

            <div class="form-group">
              <label for="address">Address *</label>
              <input
                id="address"
                type="text"
                [(ngModel)]="checkoutForm.address"
                name="address"
                class="form-input"
                [class.error]="getFieldError('address')"
              />
              <span *ngIf="getFieldError('address')" class="error-message">{{
                getFieldError("address")
              }}</span>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">City *</label>
                <input
                  id="city"
                  type="text"
                  [(ngModel)]="checkoutForm.city"
                  name="city"
                  class="form-input"
                  [class.error]="getFieldError('city')"
                />
                <span *ngIf="getFieldError('city')" class="error-message">{{
                  getFieldError("city")
                }}</span>
              </div>
              <div class="form-group">
                <label for="state">State *</label>
                <input
                  id="state"
                  type="text"
                  [(ngModel)]="checkoutForm.state"
                  name="state"
                  class="form-input"
                  [class.error]="getFieldError('state')"
                />
                <span *ngIf="getFieldError('state')" class="error-message">{{
                  getFieldError("state")
                }}</span>
              </div>
              <div class="form-group">
                <label for="zipCode">ZIP Code *</label>
                <input
                  id="zipCode"
                  type="text"
                  [(ngModel)]="checkoutForm.zipCode"
                  name="zipCode"
                  class="form-input"
                  [class.error]="getFieldError('zipCode')"
                />
                <span *ngIf="getFieldError('zipCode')" class="error-message">{{
                  getFieldError("zipCode")
                }}</span>
              </div>
            </div>
          </div>

          <!-- Payment Information -->
          <div class="form-section">
            <h3>Payment Information</h3>
            <div class="form-group">
              <label for="paymentMethod">Payment Method</label>
              <select
                id="paymentMethod"
                [(ngModel)]="checkoutForm.paymentMethod"
                name="paymentMethod"
                class="form-select"
              >
                <option value="credit">Credit Card</option>
                <option value="debit">Debit Card</option>
                <option value="paypal">PayPal</option>
              </select>
            </div>

            <div
              *ngIf="
                checkoutForm.paymentMethod === 'credit' ||
                checkoutForm.paymentMethod === 'debit'
              "
            >
              <div class="form-group">
                <label for="cardNumber">Card Number *</label>
                <input
                  id="cardNumber"
                  type="text"
                  [(ngModel)]="checkoutForm.cardNumber"
                  name="cardNumber"
                  placeholder="1234 5678 9012 3456"
                  class="form-input"
                  [class.error]="getFieldError('payment')"
                />
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="expiryDate">Expiry Date *</label>
                  <input
                    id="expiryDate"
                    type="text"
                    [(ngModel)]="checkoutForm.expiryDate"
                    name="expiryDate"
                    placeholder="MM/YY"
                    class="form-input"
                    [class.error]="getFieldError('payment')"
                  />
                </div>
                <div class="form-group">
                  <label for="cvv">CVV *</label>
                  <input
                    id="cvv"
                    type="text"
                    [(ngModel)]="checkoutForm.cvv"
                    name="cvv"
                    placeholder="123"
                    class="form-input"
                    [class.error]="getFieldError('payment')"
                  />
                </div>
              </div>
            </div>

            <span *ngIf="getFieldError('payment')" class="error-message">{{
              getFieldError("payment")
            }}</span>
          </div>

          <!-- Order Summary in Checkout -->
          <div class="form-section">
            <h3>Order Summary</h3>
            <div class="order-summary-checkout">
              <div class="summary-line">
                <span>Subtotal:</span>
                <span>{{ formatCurrency(getSubtotal()) }}</span>
              </div>
              <div class="summary-line">
                <span>Shipping:</span>
                <span>{{ formatCurrency(getShipping()) }}</span>
              </div>
              <div class="summary-line">
                <span>Tax:</span>
                <span>{{ formatCurrency(getTax()) }}</span>
              </div>
              <div class="summary-line total">
                <span>Total:</span>
                <span>{{ formatCurrency(getTotal()) }}</span>
              </div>
            </div>
          </div>

          <div class="checkout-actions">
            <button
              type="button"
              class="btn-secondary"
              (click)="showCheckoutForm = false"
            >
              Back to Cart
            </button>
            <button type="submit" class="btn-primary" [disabled]="isProcessing">
              <span *ngIf="!isProcessing">Place Order</span>
              <span *ngIf="isProcessing">
                <div class="spinner-small"></div>
                Processing...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Order Summary Sidebar -->
    <div *ngIf="!showCheckoutForm" class="cart-sidebar">
      <div class="order-summary">
        <h3>Order Summary</h3>
        <div class="summary-line">
          <span>Subtotal ({{ cartItems.length }} items):</span>
          <span>{{ formatCurrency(getSubtotal()) }}</span>
        </div>
        <div class="summary-line">
          <span>Shipping:</span>
          <span>{{ formatCurrency(getShipping()) }}</span>
        </div>
        <div class="summary-line">
          <span>Tax:</span>
          <span>{{ formatCurrency(getTax()) }}</span>
        </div>
        <div class="summary-line total">
          <span>Total:</span>
          <span>{{ formatCurrency(getTotal()) }}</span>
        </div>

        <div class="checkout-actions">
          <button class="btn-primary btn-full" (click)="proceedToCheckout()">
            Proceed to Checkout
          </button>
          <button class="btn-outline btn-full" routerLink="/products">
            Continue Shopping
          </button>
        </div>

        <!-- Promo Code -->
        <div class="promo-section">
          <h4>Promo Code</h4>
          <div class="promo-input">
            <input
              type="text"
              placeholder="Enter promo code"
              class="form-input"
            />
            <button class="btn-outline">Apply</button>
          </div>
        </div>

        <!-- Security Badge -->
        <div class="security-badge">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M12 22S8 18 8 14V7L12 5L16 7V14C16 18 12 22 12 22Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M9 12L11 14L15 10"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <span>Secure Checkout</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div
  *ngIf="showSuccessModal"
  class="modal-overlay"
  (click)="closeSuccessModal()"
>
  <div class="modal success-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="success-icon">
        <svg
          width="48"
          height="48"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </div>
      <h2>Order Placed Successfully!</h2>
      <p>
        Thank you for your purchase. You will receive a confirmation email
        shortly.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn-primary" (click)="closeSuccessModal()">
        Continue Shopping
      </button>
    </div>
  </div>
</div>
