<div class="products-container">
    <!-- Admin Header -->
    <div *ngIf="currentUser?.role === 'admin'" class="admin-header">
      <button
        mat-button
        class="back-button"
        [routerLink]="['/admin/dashboard']"
      >
        <mat-icon>arrow_back</mat-icon>
        Back to Dashboard
      </button>
      <h1>Manage Products</h1>
      <button
        mat-raised-button
        color="primary"
        class="create-button"
        [routerLink]="['/add-product']"
      >
        <mat-icon>add</mat-icon>
        Create Product
      </button>
    </div>

    <!-- Customer Header -->
    <div *ngIf="currentUser?.role !== 'admin'" class="page-header">
      <h1>Our Products</h1>
      <p>Browse our amazing collection of products</p>
    </div>

    <!-- Search and Filters Section -->
    <div class="filters-section">
      <div class="search-box">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <input
          type="text"
          placeholder="Search products by name..."
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          class="search-input"
        >
      </div>

      <div class="filter-group">
        <select
          [(ngModel)]="selectedCategory"
          (change)="onCategoryFilter()"
          class="filter-select"
        >
          <option value="">All Categories</option>
          <option *ngFor="let category of categories" [value]="category.name">
            {{ category.name }}
          </option>
        </select>
      </div>

      <div class="results-info">
        <span>{{ filteredProducts.length }} products found</span>
      </div>
    </div>

   <mat-spinner *ngIf="isLoading" class="spinner"></mat-spinner>
   <div *ngIf="errorMessage && !isLoading" class="error">
     {{ errorMessage }}
   </div>

   <!-- Products Grid -->
   <div class="product-grid" *ngIf="filteredProducts.length && !isLoading">
     <div *ngFor="let product of filteredProducts" class="product-card">
       <div class="product-image-container">
         <img
           [src]="product.imageUrl || 'https://via.placeholder.com/300x200/cccccc/666666?text=No+Image'"
           alt="{{ product.name }}"
           class="product-image"
           onerror="this.src='https://via.placeholder.com/300x200/cccccc/666666?text=No+Image'"
         />
       </div>
       <div class="product-content">
         <h3 class="product-title">{{ product.name }}</h3>
         <p class="product-price">{{ formatCurrency(product.price) }}</p>
         <p class="product-category">{{ product.category?.name || 'Uncategorized' }}</p>
         <p class="product-date">Added: {{ product.createdAt | date: 'mediumDate' }}</p>
       </div>
       <div class="product-actions">
         <!-- Customer Actions -->
         <button
           *ngIf="currentUser?.role !== 'admin'"
           mat-raised-button
           color="primary"
           class="add-to-cart-btn"
           (click)="addToCart(product)"
         >
           <mat-icon>add_shopping_cart</mat-icon>
           Add to Cart
         </button>
         <!-- Admin Actions -->
         <div *ngIf="currentUser?.role === 'admin'" class="admin-actions">
           <button
             mat-icon-button
             [routerLink]="['/add-product', product.id]"
             title="Edit Product"
             class="edit-btn"
             aria-label="Edit Product"
           >
             <mat-icon>edit</mat-icon>
           </button>
           <button
             mat-icon-button
             (click)="deleteProduct(product.id)"
             title="Delete Product"
             class="delete-btn"
             aria-label="Delete Product"
           >
             <mat-icon>delete</mat-icon>
           </button>
         </div>
       </div>
     </div>
   </div>

   <!-- No Products State -->
   <div *ngIf="filteredProducts.length === 0 && !isLoading && !errorMessage" class="no-products">
     <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
       <path d="M20 7L9 18L4 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
     </svg>
     <h3>No products found</h3>
     <p>Try adjusting your search or filter criteria</p>
   </div>
</div>