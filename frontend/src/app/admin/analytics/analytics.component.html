<div class="admin-analytics">
  <div class="page-header">
    <h1>Analytics Dashboard</h1>
    <p>Comprehensive insights into your boutique performance</p>
  </div>

  <!-- Controls -->
  <div class="controls-section">
    <div class="period-selector">
      <label for="period">Time Period:</label>
      <select id="period" [(ngModel)]="selectedPeriod" (change)="onPeriodChange()" class="period-select">
        <option value="7">Last 7 days</option>
        <option value="30">Last 30 days</option>
        <option value="90">Last 90 days</option>
        <option value="365">Last year</option>
      </select>
    </div>

    <div class="chart-type-selector">
      <label>Chart Type:</label>
      <div class="chart-toggle">
        <button
          class="toggle-btn"
          [class.active]="chartType === 'revenue'"
          (click)="chartType = 'revenue'"
        >
          Revenue
        </button>
        <button
          class="toggle-btn"
          [class.active]="chartType === 'orders'"
          (click)="chartType = 'orders'"
        >
          Orders
        </button>
      </div>
    </div>

    <button class="btn-primary" (click)="exportReport()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Export Report
    </button>
  </div>

  <!-- Key Metrics -->
  <div class="metrics-grid" *ngIf="stats">
    <div class="metric-card">
      <div class="metric-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="metric-content">
        <h3>Total Users</h3>
        <p class="metric-value">{{ stats.totalUsers }}</p>
        <span class="metric-change positive">+12%</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="metric-content">
        <h3>Total Orders</h3>
        <p class="metric-value">{{ stats.totalOrders }}</p>
        <span class="metric-change positive">+8%</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M16 11V7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7V11M5 9H19L18 21H6L5 9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="metric-content">
        <h3>Total Products</h3>
        <p class="metric-value">{{ stats.totalProducts }}</p>
        <span class="metric-change neutral">0%</span>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="12" y1="1" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="metric-content">
        <h3>Total Revenue</h3>
        <p class="metric-value">{{ formatCurrency(stats.totalRevenue) }}</p>
        <span class="metric-change positive">+15%</span>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-grid">
    <!-- Revenue Chart -->
    <div class="chart-card">
      <div class="chart-header">
        <h3>{{ chartType === 'revenue' ? 'Revenue Trend' : 'Orders Trend' }}</h3>
        <div class="chart-legend">
          <span class="legend-item">
            <span class="legend-color" style="background: #667eea;"></span>
            {{ chartType === 'revenue' ? 'Revenue' : 'Orders' }}
          </span>
        </div>
      </div>
      <div class="chart-container">
        <div class="simple-chart" *ngIf="revenueData.length > 0">
          <div
            class="chart-bar"
            *ngFor="let item of getChartData(); let i = index"
            [style.height.%]="(item.value / getMaxValue()) * 100"
            [style.background-color]="i % 2 === 0 ? '#667eea' : '#764ba2'"
            [title]="item.name + ': ' + (chartType === 'revenue' ? formatCurrency(item.value) : item.value)"
          ></div>
        </div>
        <div class="no-data-chart" *ngIf="revenueData.length === 0">
          <p>No data available</p>
        </div>
      </div>
    </div>

    <!-- Top Products -->
    <div class="chart-card">
      <div class="chart-header">
        <h3>Top Products</h3>
      </div>
      <div class="top-products-list">
        <div class="product-item" *ngFor="let product of topProducts; let i = index">
          <div class="product-rank">{{ i + 1 }}</div>
          <div class="product-info">
            <h4>{{ product.name }}</h4>
            <p>{{ product.sales }} sales</p>
          </div>
          <div class="product-revenue">
            {{ formatCurrency(product.revenue) }}
          </div>
        </div>
        <div class="no-products" *ngIf="topProducts.length === 0">
          <p>No products data available</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Location Data -->
  <div class="location-section" *ngIf="locationData.length > 0">
    <div class="section-header">
      <h3>Top Locations</h3>
    </div>
    <div class="location-grid">
      <div class="location-card" *ngFor="let location of locationData">
        <div class="location-name">{{ location.name }}</div>
        <div class="location-stats">
          <span class="location-orders">{{ location.orders }} orders</span>
          <span class="location-revenue">{{ formatCurrency(location.revenue) }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading analytics data...</p>
  </div>
</div>